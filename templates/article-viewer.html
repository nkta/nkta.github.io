<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:">
    <title>Article</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../styles/dark-mode.css">
    <link rel="stylesheet" href="../../styles/markdown.css">
    <!-- Ajout de marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <button id="theme-toggle">
        <span class="light-mode">üåô</span>
        <span class="dark-mode">‚òÄÔ∏è</span>
    </button>
    
    <div class="container mt-5">
        <div id="markdown-content" class="markdown-content">
            <p>Chargement de l'article...</p>
        </div>
    </div>

    <script>
        // Configuration de marked pour une meilleure s√©curit√©
        marked.setOptions({
            headerIds: false,
            mangle: false,
            breaks: true,
            gfm: true
        });

        // Fonction pour charger et afficher le fichier Markdown
        async function loadMarkdown() {
            const urlParams = new URLSearchParams(window.location.search);
            const mdFile = urlParams.get('article');
            
            if (!mdFile) {
                document.getElementById('markdown-content').innerHTML = 'Erreur : Aucun article sp√©cifi√©';
                return;
            }

            try {
                console.log('Tentative de chargement de:', mdFile);
                // Ajout de l'extension .md si elle n'est pas pr√©sente
                const fullPath = mdFile.endsWith('.md') ? mdFile : `${mdFile}.md`;
                const response = await fetch(`../${fullPath}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                console.log('Contenu charg√©:', text.substring(0, 100) + '...');
                
                // Suppression des m√©tadonn√©es YAML et traitement du Markdown
                const contentWithoutYAML = text.replace(/^---[\s\S]*?---\n/, '');
                const htmlContent = marked.parse(contentWithoutYAML);
                
                document.getElementById('markdown-content').innerHTML = htmlContent;
                
                // Mise √† jour du titre de la page
                const firstLine = contentWithoutYAML.split('\n')[0];
                document.title = firstLine.replace(/^#\s+/, '');
            } catch (error) {
                console.error('Erreur lors du chargement du fichier Markdown:', error);
                document.getElementById('markdown-content').innerHTML = 
                    `Erreur lors du chargement de l'article: ${error.message}`;
            }
        }

        // Gestion du th√®me
        const themeToggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // Charger le Markdown au chargement de la page
        loadMarkdown();
    </script>
</body>
</html> 